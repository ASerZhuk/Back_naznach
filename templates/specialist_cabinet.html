<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Дашборд</title>
    <style>
      :root {
        --bg-start: #0b1020;
        --bg-end: #1f2a44;
        --card-bg: rgba(255, 255, 255, 0.08);
        --border: rgba(255, 255, 255, 0.16);
        --text: #e5e7eb;
        --muted: #94a3b8;
        --primary: #4f46e5;
        --primary-2: #7c3aed;
      }
      @media (prefers-color-scheme: light) {
        :root {
          --bg-start: #eef2ff;
          --bg-end: #e0e7ff;
          --card-bg: rgba(255, 255, 255, 0.72);
          --border: rgba(15, 23, 42, 0.08);
          --text: #0f172a;
          --muted: #475569;
          --primary: #4f46e5;
          --primary-2: #7c3aed;
        }
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu,
          Cantarell, "Helvetica Neue", Arial;
        color: var(--text);
        background: radial-gradient(
            1200px 800px at 10% 10%,
            #1e293b33,
            transparent 40%
          ),
          radial-gradient(1000px 700px at 90% 20%, #4f46e533, transparent 45%),
          linear-gradient(160deg, var(--bg-start), var(--bg-end));
        padding: 24px;
      }
      .container {
        max-width: 1100px;
        margin: 0 auto;
      }
      header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 16px;
      }
      .brand {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 36px;
        height: 36px;
        border-radius: 10px;
        background: linear-gradient(135deg, var(--primary), var(--primary-2));
        color: #fff;
        font-weight: 700;
      }
      h1 {
        font-size: 22px;
        margin: 0;
      }
      .nav {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        margin: 10px 0 20px;
      }
      .tab {
        padding: 10px 12px;
        border: 1px solid var(--border);
        border-radius: 10px;
        background: var(--card-bg);
        color: var(--text);
        cursor: pointer;
      }
      .tab.active {
        outline: 2px solid color-mix(in oklab, var(--primary) 30%, transparent);
      }
      .grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 16px;
      }
      @media (min-width: 900px) {
        .grid {
          grid-template-columns: 1fr 1fr;
        }
      }
      .card {
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 16px;
      }
      .card h2 {
        margin: 0 0 10px;
        font-size: 18px;
      }
      .muted {
        color: var(--muted);
      }
      .btn {
        padding: 10px 14px;
        border-radius: 10px;
        border: 0;
        background: linear-gradient(135deg, var(--primary), var(--primary-2));
        color: #fff;
        cursor: pointer;
      }
      .danger {
        background: linear-gradient(135deg, #dc2626, #ef4444);
      }
      table {
        width: 100%;
        border-collapse: collapse;
      }
      th,
      td {
        text-align: left;
        padding: 8px 6px;
        border-bottom: 1px solid var(--border);
      }
    </style>
    <script>
      async function logout() {
        await fetch("/api/auth/specialist/logout", { method: "POST" });
        window.location.href = location.origin + "/login";
      }
      function setTab(tab) {
        document
          .querySelectorAll(".tab")
          .forEach((t) => t.classList.remove("active"));
        document.getElementById("tab-" + tab).classList.add("active");
        document
          .querySelectorAll(".section")
          .forEach((s) => (s.style.display = "none"));
        document.getElementById("section-" + tab).style.display = "block";
      }
      window.addEventListener("DOMContentLoaded", () => setTab("profile"));
    </script>
  </head>
  <body>
    <div class="container">
      <header>
        <div class="brand">
          <div class="badge">N</div>
          <div style="font-weight: 700">Naznach Admin</div>
        </div>
        <button class="btn danger" onclick="logout()">Выйти</button>
      </header>

      <nav class="nav">
        <button id="tab-profile" class="tab" onclick="setTab('profile')">
          Профиль
        </button>
        <button id="tab-schedule" class="tab" onclick="setTab('schedule')">
          Расписание
        </button>
        <button id="tab-services" class="tab" onclick="setTab('services')">
          Услуги
        </button>
        <button
          id="tab-appointments"
          class="tab"
          onclick="setTab('appointments')"
        >
          Записи
        </button>
      </nav>

      <section id="section-profile" class="section grid">
        <div class="card">
          <h2>Профиль</h2>
          <div class="muted">Основная информация</div>
          <p>
            Имя: {{ specialist.first_name or '' }} {{ specialist.last_name or ''
            }}
          </p>
          <p>Телефон: {{ specialist.phone or '-' }}</p>
          <p>Адрес: {{ specialist.address or '-' }}</p>
          <p>Статус: {{ specialist.status or '-' }}</p>
          <button class="btn" onclick="location.reload()">Сохранить</button>
        </div>
        <div class="card">
          <h2>Ссылка в Telegram</h2>
          <p class="muted">Отправьте клиентам вашу персональную ссылку</p>
          <p>
            <a href="{{ specialist.telegram_link or '#' }}" target="_blank"
              >{{ specialist.telegram_link or '-' }}</a
            >
          </p>
        </div>
      </section>

      <section id="section-schedule" class="section" style="display: none">
        <div class="card">
          <h2>График</h2>
          <div class="muted">Доступные записи и рабочее время</div>
          <table>
            <thead>
              <tr>
                <th>Тип</th>
                <th>День/Дата</th>
                <th>Время</th>
              </tr>
            </thead>
            <tbody>
              {% for g in specialist.grafiks %}
              <tr>
                <td>{{ g.grafik_type }}</td>
                <td>{{ g.specific_date or g.day_of_week }}</td>
                <td>
                  {% if g.time_slots %}{{ ', '.join(g.time_slots) }}{% else %}{{
                  g.start_time or '-' }} - {{ g.end_time or '-' }}{% endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          <button class="btn" onclick="location.reload()">Обновить</button>
        </div>
      </section>

      <section id="section-services" class="section" style="display: none">
        <div class="card">
          <h2>Услуги</h2>
          <table>
            <thead>
              <tr>
                <th>Название</th>
                <th>Цена</th>
                <th>Длительность</th>
              </tr>
            </thead>
            <tbody>
              {% for s in specialist.services %}
              <tr>
                <td>{{ s.name }}</td>
                <td>{{ (s.price or '-') ~ ' ' ~ (s.valuta or '') }}</td>
                <td>{{ s.duration or '-' }} мин</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          <button class="btn" onclick="location.reload()">Обновить</button>
        </div>
      </section>

      <section id="section-appointments" class="section" style="display: none">
        <div class="card">
          <h2>Записи</h2>
          <table>
            <thead>
              <tr>
                <th>Дата</th>
                <th>Время</th>
                <th>Услуга</th>
                <th>Клиент</th>
              </tr>
            </thead>
            <tbody>
              {% for a in specialist.appointments %}
              <tr>
                <td>{{ a.date }}</td>
                <td>{{ a.time }}</td>
                <td>{{ a.service_name or '-' }}</td>
                <td>{{ a.client_name or a.client_id }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          <button class="btn" onclick="location.reload()">Обновить</button>
        </div>
      </section>
    </div>
  </body>
</html>
